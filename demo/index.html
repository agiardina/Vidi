<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Theme Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="vendors/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="vendors/bootstrap-slider.min.css" rel="stylesheet">

    <style>

        html,
        body,
        .container-fluid,
        .container-fluid > .row{
            height: 100%;
        }

        .container-fluid > .row > div{
            padding-top: 50px;
        }

        #sidebar {
            height: 100%;
        }

        .panel {
            margin-top: 20px;
        }

        body.edit {
            background:#000;
        }

        .color-box {
            width:80px;
            height: 50px;
            display: inline-block;
        }

    </style>
</head>

<body role="document">


<!-- Fixed navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Vidi.js Showcase</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="#">Home</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">File <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" class="loadImage" data-src="samples/food.jpg">Load food.jpg</a></li>
                        <li><a href="#" class="loadImage" data-src="samples/building.jpg">Load building.jpg</a></li>
                        <li><a href="#" class="loadImage" data-src="samples/lighthouse.jpg">Load lighthouse.jpg</a></li>
                        <li><a href="#" class="loadImage" data-src="samples/boat.jpg">Load boat.jpg</a></li>
                        <li><a href="#" class="loadImage" data-src="samples/mountains.jpg">Load mountains.jpg (big)</a></li>
                        <li><a href="#" class="loadImage" data-src="samples/circle.png">Load circle.png</a></li>
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Point operations <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" class="actionInvert">Invert</a></li>
                        <li class="divider"></li>
                        <li><a href="#" class="contrastLink" data-toggle="collapse" data-target="#panel-contrast">Change contrast/brightness</a></li>
                        <li><a href="#" class="actionAutoContrast">Autocontrast</a></li>
                        <li class="divider"></li>
                        <li><a href="#" class="actionToGray">To grayscale</a></li>
                        <li><a href="#">Threesold</a></li>
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Filters<span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" class="actionBoxFilter">Smooth Box Filter (3x3)</a></li>
                        <li><a href="#" class="actionBoxFilter7">Smooth Box Filter (7x7)</a></li>
                        <li><a href="#" class="actionGaussianFilter">Smooth Gaussian Filter (sigma 0.8)</a></li>
                        <li><a href="#" class="actionGaussianFilter2">Smooth Gaussian Filter (sigma 2)</a></li>
                        <li><a href="#" class="actionUnsharpMask">Unsharp Mask</a></li>
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Edge detection<span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#" class="actionSobel">Sobel</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Colors <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li class="panel-menu two-panels-menu"><a href="#" class="actionNColors">Number of colors</a></li>
                        <li class="panel-menu two-panels-menu"><a href="#" class="actionColorPalette" data-toggle="collapse" data-target="#panel-colorpalette">Generate color palette</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Setting <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li class="dropdown-header">Image panels</li>
                        <li class="panel-menu two-panels-menu active"><a href="#" class="twoPanelsMenuLink">Two-panels view</a></li>
                        <li class="panel-menu single-panel-menu"><a href="#" class="singlePanelMenuLink">Single-panel view</a></li>
                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</div>

<div class="theme-showcase container-fluid" role="main">
    <div class="row">
        <div class="col-md-4 image-panel1-container">

            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">Before</h3>
                </div>
                <div class="panel-body">
                    <canvas id="src" src="samples/building.jpg" class="img-responsive"></canvas>
                </div>
            </div>

        </div>
        <div class="col-md-4 image-panel2-container">

            <div class="panel panel-success">
                <div class="panel-heading">
                    <h3 class="panel-title">After</h3>
                </div>
                <div class="panel-body">
                    <canvas id="target" class="img-responsive"></canvas>
                </div>
            </div>

        </div>
        <div class="col-md-4 bg-warning" id="sidebar">

            <div class="panel panel-default collapse" id="panel-contrast">
                <div class="panel-body">
                    <p><span>Contrast:</span> <b>-50%</b> <input type="text" class="slider" value="" id="slider-contrast" data-slider-min="-50" data-slider-max="100" data-slider-step="1" data-slider-value="0" data-slider-id="contrast" /> <b>100%</b></p>
                    <hr>
                    <p><span>Brightness: </span> <b>-150</b> <input type="text" class="slider" value="" id="slider-brightness" data-slider-min="-150" data-slider-max="150" data-slider-step="1" data-slider-value="0" data-slider-id="brightness" /> <b>150</b></p>
                    <hr>
                    <p class="text-right">
                        <button type="button" class="btn btn-lg btn-warning cancel"  data-toggle="collapse" data-target="#panel-contrast">Cancel</button>
                        <button type="button" class="btn btn-lg btn-primary save" data-toggle="collapse" data-target="#panel-contrast">Save</button>
                    </p>
                </div>

            </div>

            <div class="panel panel-default collapse" id="panel-colorpalette">
                <div class="panel-heading">
                    <h3 class="panel-title">Colors</h3>
                </div>
                <div class="panel-body">
                    <div class="color-box" id="c0"></div>
                    <div class="color-box" id="c1"></div>
                    <div class="color-box" id="c2"></div>
                    <div class="color-box" id="c3"></div>
                    <div class="color-box" id="c4"></div>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Histogram</h3>
                </div>
                <div class="panel-body">
                        <canvas id="lumHistogram" width="256" height="100" class="img-responsive" style="height: 100px"></canvas>
                        <canvas id="rgbHistogram" width="256" height="100" class="img-responsive" style="height: 100px"></canvas>
                </div>
            </div>

        </div>
    </div>
</div> <!-- /container -->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="vendors/jquery-1.11.1.min.js"></script>
<script src="vendors/bootstrap/js/bootstrap.min.js"></script>
<script src="vendors/bootstrap-slider.min.js"></script>
<script src="../src/vidi.js"></script>
<script src="../src/vidi/utils.js"></script>
<script src="../src/vidi/color.js"></script>
<script src="../src/vidi/histogram.js"></script>
<script src="../src/vidi/point.js"></script>
<script src="../src/vidi/filters.js"></script>
<script src="../src/vidi/edge.js"></script>
<script>
    $(function () {

        var vidiImg,
            vidiImgTmp;

        function getTarget() {
            if ($('.single-panel-menu').hasClass('active')) {
                return document.getElementById('src');
            } else {
                return document.getElementById('target');
            }

        }

        function loadImage(src) {
            var canvas = document.getElementById('src'),
                target = document.getElementById('target'),
                img = new Image();

            img.src = src;
            img.addEventListener('load',function () {
                canvas.width = img.width;
                canvas.height = img.height;
                canvas.getContext('2d').drawImage(img,0,0);

                target.width = img.width;
                target.height = img.height;
                target.getContext('2d').drawImage(img,0,0);

                vidiImg = new Vidi(canvas);
                vidiImgTmp = new Vidi(canvas);
                showHistograms(vidiImg.imageData);
            });
        }

        function showHistograms(imageData) {
            var lumHistogramCanvas = document.getElementById('lumHistogram'),
                rgbHistogramCanvas = document.getElementById('rgbHistogram');

            lumHistogramCanvas.width = lumHistogramCanvas.width;
            rgbHistogramCanvas.width = rgbHistogramCanvas.width;

            Vidi.showLuminanceHistogram(imageData,lumHistogramCanvas);

            Vidi.showRedHistogram(imageData,rgbHistogramCanvas);
            Vidi.showGreenHistogram(imageData,rgbHistogramCanvas);
            Vidi.showBlueHistogram(imageData,rgbHistogramCanvas);
        }

        function updateHistograms(imageData) {
            imageData = imageData || vidiImg.imageData;
            showHistograms(imageData);
        }

        function closeContrastPanel() {
            $('body').removeClass('edit');
            $('.navbar-fixed-top').fadeIn();
            $('#slider-contrast').slider('setValue',0);
            updateHistograms();
        }

        function applyBrightnessContrast() {
            var contrast = ($('#slider-contrast').slider('getValue') + 100) / 100,
                brightness = $('#slider-brightness').slider('getValue'),
                vidiCB = new Vidi(document.getElementById('src'));

            vidiCB.imageData = Vidi.cloneImageData(vidiImg.imageData);
            vidiCB.contrast(contrast).brightness(brightness).show(getTarget());
            updateHistograms(vidiCB.imageData);
        }

        $(".slider").slider({});

        $('.loadImage').on('click',function () {
            loadImage($(this).data('src'));
        });

        $('.singlePanelMenuLink').on('click', function () {
            $('.image-panel2-container').hide();
            $('.image-panel1-container').removeClass('col-md-4');
            $('.image-panel1-container').addClass('col-md-8');
            $('.panel-menu').removeClass('active');
            $(this).parent().addClass('active');
        });

        $('.twoPanelsMenuLink').on('click', function () {
            $('.image-panel2-container').show();
            $('.image-panel1-container').removeClass('col-md-8');
            $('.image-panel1-container').addClass('col-md-4');
            $('.panel-menu').removeClass('active');
            $(this).parent().addClass('active');
        });

        $('.contrastLink').on('click',function () {
            $('body').addClass('edit');
            $('.navbar-fixed-top').fadeOut();
        });

        $('.actionInvert').on('click',function () {
            vidiImg.invert().show(getTarget());
            updateHistograms();
        });

        $('.actionAutoContrast').on('click',function () {
            vidiImg.autoContrast().show(getTarget());
            updateHistograms();
        });

        $('.actionToGray').on('click',function () {
            vidiImg.toGray().show(getTarget());
            updateHistograms();
        });

        $('.actionSobel').on('click',function () {
            vidiImg.sobelEdgeDetect().show(getTarget());
            updateHistograms();
        });

        $('.actionBoxFilter').on('click',function () {
            vidiImg.boxFilter(3).show(getTarget());
            updateHistograms();
        });

        $('.actionBoxFilter7').on('click',function () {
            vidiImg.boxFilter(7).show(getTarget());
            updateHistograms();
        });

        $('.actionGaussianFilter').on('click',function () {
            vidiImg.imageData = Vidi.gaussianFilter(vidiImg.imageData,0.8);
            vidiImg.show(getTarget());
            updateHistograms();
        });

        $('.actionGaussianFilter2').on('click',function () {
            vidiImg.imageData = Vidi.gaussianFilter(vidiImg.imageData,2);
            vidiImg.show(getTarget());
            updateHistograms();
        });

        $('.actionUnsharpMask').on('click',function () {
            vidiImg.imageData = Vidi.unsharpMask(vidiImg.imageData,10,1);
            vidiImg.show(getTarget());
            updateHistograms();
        });


        $('.actionColorPalette').on('click', function() {
            var i,
                color,
                selected_colors = Vidi.findRepresentativeColors(vidiImg.imageData,5);

            for (i=0;i<selected_colors.length;i++) {
                color = selected_colors[i];
                $('#c'+i).css('background-color','rgb('+color[0]+','+color[1]+','+color[2]+')')
            }
        });

        $('#slider-contrast').on('slide',function () {
            applyBrightnessContrast();
        });

        $('#slider-brightness').on('slide',function () {
            applyBrightnessContrast();
        });

        $('#panel-contrast .cancel').on('click', function () {
            vidiImg.show(getTarget());
            closeContrastPanel();
        });

        $('#panel-contrast .save').on('click', function () {
            vidiImg.imageData = new Vidi(getTarget()).imageData;
            closeContrastPanel();
        });

        loadImage('samples/building.jpg');
    });
</script>
</body>
</html>
