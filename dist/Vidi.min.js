/*! Vidi 07-09-2014 */
var Vidi=function(a){var b;this.source=a,this.canvas=document.createElement("canvas"),"HTMLCanvasElement"===a.constructor.name?(this.canvas.width=a.width,this.canvas.height=a.height):"HTMLImageElement"===a.constructor.name&&(b=new Image,b.src=a.getAttribute("src"),this.canvas.width=b.width,this.canvas.height=b.height),this.context=this.canvas.getContext("2d"),this.context.drawImage(a,0,0),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height)};Vidi.prototype.flush=function(){this.imageData=null},Vidi.prototype.show=function(a){var b;a||(a=this.source),a.getContext?a.getContext("2d").putImageData(this.imageData,0,0):(this.context.putImageData(this.imageData,0,0),b=this.canvas.toDataURL(),a.setAttribute("src",b))},Vidi.prototype.invert=function(){return Vidi.invert(this.imageData),this},Vidi.prototype.contrast=function(a){return Vidi.contrast(this.imageData,a),this},Vidi.prototype.autoContrast=function(){return Vidi.autoContrast(this.imageData),this},Vidi.prototype.brightness=function(a){return Vidi.brightness(this.imageData,a),this},Vidi.prototype.toGray=function(){return Vidi.toGray(this.imageData),this},Vidi.prototype.threshold=function(a){return Vidi.threshold(this.imageData,a),this},Vidi.prototype.customFilter=function(a){return Vidi.customFilter(this.imageData,a),this},Vidi.prototype.boxFilter=function(a,b){return Vidi.boxFilter(this.imageData,a,b),this},function(a){"use strict";function b(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}function c(b){var c,d,e,f,g,h,i,j,k,l=a.timer();for(l.silent=!0,c=a.getDataAsPixels(b.data),l.time("getDataAsPixels"),c=a.radixSort(c),l.time("radixSort"),f=c[0],g=1,d=c.length,h=[],e=1;d>e;e++)c[e]!==c[e-1]?(i=f>>16&255,j=f>>8&255,k=255&f,h.push([i,j,k,g]),f=c[e],g=1):g++;return h.push([i,j,k,g]),l.time("colors push"),h.sort(function(a,b){return b[1]-a[1]}),l.time("colors sort"),h}function d(a,b){function d(a,b){for(var c,d=a.length,e=255,f=0,g=255,h=0,i=255,j=0;d;)d--,c=a[d],c[0]<e&&(e=c[0]),c[0]>f&&(f=c[0]),c[1]<g&&(g=c[1]),c[1]>h&&(h=c[1]),c[2]<i&&(i=c[2]),c[2]>j&&(j=c[2]);return{colors:a,level:b,rMin:e,rMax:f,gMin:g,gMax:h,bMin:i,bMax:j}}function e(a){var b,c,d,e,f,g=a.length,h=null,i=Number.MAX_VALUE;for(b=0;g>b;b++)f=a[b],d=f.colors.length,e=f.level,d>=2&&i>e&&(h=f,i=e,c=b);return h&&a.splice(c,1),h}function f(a){var b=a.rMax-a.rMin,c=a.gMax-a.gMin,d=a.bMax-a.bMax,e=Math.max(b,c,d);return e===b?0:e===c?1:2}function g(a){var b,c,e,g,h,i=a.level,j=f(a),k=a.colors;return k.sort(function(a,b){return a[j]-b[j]}),b=parseInt(k.length/2),c=k.slice(0,b),e=k.slice(b),g=d(c,i+1),h=d(e,i+1),[g,h]}function h(a){for(var b,c,d,e,f,g,h,i,j=a.colors,k=0,l=0,m=0,n=0,o=j.length;o;)o--,b=j[o],g=b[0],h=b[1],i=b[2],f=b[3],k+=f,l+=f*g,m+=f*h,n+=f*i;return c=parseInt(l/k),d=parseInt(m/k),e=parseInt(n/k),[c,d,e]}var i,j,k,l,m,n,o,p=[],q=Vidi.timer();if(i=c(a),i.length<=b)p=i;else{for(l=d(i,0),j=[l],m=1,n=!1;b>m&&!n;)k=e(j),k?(o=g(k),j=j.concat(o),m+=1):n=!0;j.forEach(function(a){p.push(h(a))})}return q.time("Color Palette"),p}a.findRepresentativeColors=d,a.getEuclideanRGBDistance=b}(Vidi),function(a){"use strict";function b(b){var c,d,e,f=a.cloneImageData(b),g=a.cloneImageData(b),h=b.data,i=h.length;for(c=a.calculateFilterData(f,[[-1,0,1],[-2,0,2],[-1,0,1]]),d=a.calculateFilterData(g,[[-1,-2,-1],[0,0,0],[1,2,1]]);i--;)e=Math.sqrt(c[i]*c[i]+d[i]*d[i]),h[i]=e>50?e:0;return b}a.sobelEdgeDetect=b}(Vidi),function(a){"use strict";function b(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=a.data,p=a.width,q=a.height,r=(b[0].length-1)/2,s=(b.length-1)/2,t=new Int16Array(a.data);for(d=c?1/c:1,h=s;q-s>h;h++)for(g=r;p-r>g;g++){for(i=4*h*p+4*g,l=0,m=0,n=0,e=-s;s>=e;e++)for(f=-r;r>=f;f++)k=b[e+s][f+r],j=4*(h+e)*p+4*(g+f),l+=o[j]*k,m+=o[j+1]*k,n+=o[j+2]*k;l=Math.round(l*d),m=Math.round(m*d),n=Math.round(n*d),t[i]=l,t[i+1]=m,t[i+2]=n,t[i+3]=o[i+3]}return t}function c(a,b,c){var e,f,g,h,i=[],j=[];if(b||(b=3),c||(c=b),b%2!==1||c%2!==1)throw"Box filter size must be and odd";for(e=b,f=c,h=0;b>h;h++)i.push(1);for(g=0;c>g;g++)j.push([1]);return a=d(a,[i],e),a=d(a,j,f)}function d(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=a.data,p=a.width,q=a.height,r=(b[0].length-1)/2,s=(b.length-1)/2,t=new Uint8ClampedArray(a.data);for(c=c||1,d=1/c,h=s;q-s>h;h++)for(g=r;p-r>g;g++){for(i=4*h*p+4*g,l=0,m=0,n=0,e=-s;s>=e;e++)for(f=-r;r>=f;f++)k=b[e+s][f+r],j=4*(h+e)*p+4*(g+f),l+=o[j]*k,m+=o[j+1]*k,n+=o[j+2]*k;l=Math.round(l*d),m=Math.round(m*d),n=Math.round(n*d),l>255?l=255:0>l&&(l=0),m>255?m=255:0>m&&(m=0),n>255?n=255:0>n&&(n=0),t[i]=l,t[i+1]=m,t[i+2]=n,t[i+3]=o[i+3]}return a.data.set(t),a}function e(a,b,c){var d,e,f,g,h,i,j,k,l,m,n=a.data,o=a.width,p=a.height,q=(b.length-1)/2,r=new Float32Array(b),s=b.length,t=new Uint8ClampedArray(a.data);for(c=c||1,d=1/c,g=0;p-q>g;g++)for(f=q;o-q>f;f++){for(h=4*g*o+4*f,k=0,l=0,m=0,e=0;s>e;e++)j=r[e],i=h-4*(e-q),k+=n[i]*j,l+=n[i+1]*j,m+=n[i+2]*j;k=Math.round(k*d),l=Math.round(l*d),m=Math.round(m*d),k>255?k=255:0>k&&(k=0),l>255?l=255:0>l&&(l=0),m>255?m=255:0>m&&(m=0),t[h]=k,t[h+1]=l,t[h+2]=m,t[h+3]=n[h+3]}return a.data.set(t),a}function f(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=a.data,p=a.width,q=a.height,r=4*p,s=(b.length-1)/2,t=new Float32Array(b),u=b.length,v=new Uint8ClampedArray(a.data);for(c=c||1,e=1/c,h=s;q-s>h;h++)for(g=0;p>g;g++){for(i=4*h*p+4*g,l=0,m=0,n=0,f=0;u>f;f++)d=f-s,k=t[f],j=i+d*r,l+=o[j]*k,m+=o[j+1]*k,n+=o[j+2]*k;l=Math.round(l*e),m=Math.round(m*e),n=Math.round(n*e),l>255?l=255:0>l&&(l=0),m>255?m=255:0>m&&(m=0),n>255?n=255:0>n&&(n=0),v[i]=l,v[i+1]=m,v[i+2]=n,v[i+3]=o[i+3]}return a.data.set(v),a}function g(a){var b,c,d=parseInt(3*a),e=a*a,f=[],g=2*d+1;for(c=0;g>c;c++)b=d-c,f[c]=Math.exp(-.5*b*b/e);return f}function h(a,b){var c,d=g(b),h=[],i=0;for(c=0;c<d.length;c++)h.push([d[c]]),i+=d[c];return a=e(a,d,i),a=f(a,d,i)}function i(a,b,c){var d,e,f=Vidi.cloneImageData(a);return b=b||2,c=c||.2,d=new Float32Array(a.data),Vidi.gaussianFilter(f,b),e=new Float32Array(f.data),Vidi.dataScale(d,1+c),Vidi.dataScale(e,c),Vidi.dataSubtract(d,e),a.data.set(new Uint8ClampedArray(d)),a}a.customFilter=d,a.xFilter=e,a.yFilter=f,a.boxFilter=c,a.calculateFilterData=b,a.makeGaussianKernel=g,a.gaussianFilter=h,a.unsharpMask=i}(Vidi),function(a){"use strict";function b(b){var c,d,e,f,g=[];for(d=a.toGray(a.cloneImageData(b)),c=d.data,e=c.length,f=0;256>f;f++)g[f]=0;for(f=0;e>f;f+=4)g[c[f]]++;return g}function c(a){var b,c,d,e=[];for(b=a.data,c=b.length,d=0;256>d;d++)e[d]=0;for(d=0;c>d;d+=4)e[b[d]]++;return e}function d(a){var b,c,d,e=[];for(b=a.data,c=b.length,d=0;256>d;d++)e[d]=0;for(d=1;c>d;d+=4)e[b[d]]++;return e}function e(a){var b,c,d,e=[];for(b=a.data,c=b.length,d=0;256>d;d++)e[d]=0;for(d=2;c>d;d+=4)e[b[d]]++;return e}function f(a,b,c){var d,e,f,g=b.getContext("2d");for(f=a.slice().sort(function(a,b){return a-b}).pop(),g.fillStyle=c,d=0;256>d;d++)e=a[d]/f*100,g.fillRect(d,100-e,1,e)}function g(a,c){var d=b(a);f(d,c,"rgba(0,0,0,0.5)")}function h(a,b){var d=c(a);f(d,b,"rgba(255,0,0,0.8)")}function i(a,b){var c=d(a);f(c,b,"rgba(0,255,0,0.8)")}function j(a,b){var c=e(a);f(c,b,"rgba(0,0,255,0.8)")}a.getLuminanceHistogram=b,a.getRedHistogram=c,a.showLuminanceHistogram=g,a.showRedHistogram=h,a.showGreenHistogram=i,a.showBlueHistogram=j}(Vidi),function(a){"use strict";function b(a){var b,c=a.data,d=a.data.length;for(b=0;d-4>b;b+=4)c[b]=255-c[b],c[b+1]=255-c[b+1],c[b+2]=255-c[b+2];return a}function c(a,b){var c,d=[],e=a.data,f=a.data.length;if(b=+b,b>=0){for(c=0;256>c;c++)d[c]=Math.round(c*b),d[c]>255&&(d[c]=255);for(c=0;f>c;c+=4)e[c]=d[e[c]],e[c+1]=d[e[c+1]],e[c+2]=d[e[c+2]],e[c+3]=d[e[c+3]];return a}throw"Contrast factor must be a positive number"}function d(a){var b,c,d,e,f,g,h,i=a.data,j=a.data.length,k=255,l=0,m=255,n=0,o=255,p=0;for(b=0;j-4>b;b+=4)f=i[b],g=i[b+1],h=i[b+2],k>f&&(k=f),f>l&&(l=f),m>g&&(m=g),g>n&&(n=g),o>h&&(o=h),h>p&&(p=h);for(c=255/(l-k),d=255/(n-m),e=255/(p-o),b=0;j-4>b;b+=4)f=i[b],g=i[b+1],h=i[b+2],i[b]=(f-k)*c,i[b+1]=(g-m)*d,i[b+2]=(h-o)*e;return a}function e(a,b){var c,d=a.data,e=a.data.length;for(b=+b,c=0;e-4>c;c+=4)d[c]+=b,d[c+1]+=b,d[c+2]+=b;return a}function f(a){var b,c,d,e,f,g=a.data,h=a.data.length;for(b=0;h-4>b;b+=4)c=.309*g[b],d=.609*g[b+1],e=.082*g[b+2],f=c+d+e,g[b]=f,g[b+1]=f,g[b+2]=f;return a}function g(a,b){var c,d=a.data,e=a.data.length;for(b=b||128,f(a),c=0;e-4>c;c+=4)d[c]<b?(d[c]=0,d[c+1]=0,d[c+2]=0):(d[c]=255,d[c+1]=255,d[c+2]=255);return a}a.invert=b,a.contrast=c,a.autoContrast=d,a.brightness=e,a.toGray=f,a.threshold=g}(Vidi),function(a){"use strict";function b(a){var b=document.createElement("canvas").getContext("2d").createImageData(a.width,a.height);return b.data.set(a.data),b}function c(a){return new Uint8ClampedArray(a)}function d(a,b){var c,d=b.length;for(c=0;d>c;c+=4)a[c]=a[c]-b[c],a[c+1]=a[c+1]-b[c+1],a[c+2]=a[c+2]-b[c+2];return a}function e(a,b){var c,d=b.length;for(c=0;d>c;c+=4)a[c]=a[c]+b[c],a[c+1]=a[c+1]+b[c+1],a[c+2]=a[c+2]+b[c+2];return a}function f(a,b){for(var c=a.length;c;)c--,a[c]=Math.round(a[c]*b);return a}function g(a){for(var b,c,d,e=a.length/4,f=new Uint32Array(e),g=0,h=0;e>g;)b=a[h]<<16,c=a[h+1]<<8,d=a[h+2],f[g]=b|c|d,g++,h=4*g;return f}function h(a){var b,c,d,e,f,g=new Int32Array(a.length),h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[].concat(h),j=[].concat(h),k=[].concat(h),l=[].concat(h),m=0,n=0,o=0,p=0;for(f=0;f<a.length;f++)b=255&a[f],c=a[f]>>8&255,d=a[f]>>16&255,e=a[f]>>24&255^128,i[b]++,j[c]++,k[d]++,l[e]++;for(f=0;256>f;f++)b=m+i[f],c=n+j[f],d=o+k[f],e=p+l[f],i[f]=m,j[f]=n,k[f]=o,l[f]=p,m=b,n=c,o=d,p=e;for(f=0;f<a.length;f++)b=255&a[f],g[i[b]]=a[f],i[b]++;for(f=0;f<a.length;f++)c=g[f]>>8&255,a[j[c]]=g[f],j[c]++;for(f=0;f<a.length;f++)d=a[f]>>16&255,g[k[d]]=a[f],k[d]++;for(f=0;f<a.length;f++)e=g[f]>>24&255^128,a[l[e]]=g[f],l[e]++;return a}function i(){var a={};return a.last_time=(new Date).getTime(),a.diff=0,a.time=function(b){var c=(new Date).getTime();return a.diff=c-a.last_time,a.last_time=c,a.silent||console.log(b+": "+a.diff),a.diff},a}a.radixSort=h,a.cloneImageData=b,a.cloneData=c,a.getDataAsPixels=g,a.dataSubtract=d,a.dataAdd=e,a.dataScale=f,a.timer=i}(Vidi);